<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Reloj Familiar Premium - Poesía Visual</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { 
            --bg: #000; 
            --card: #111; 
            --dim: #777; 
            --font-soft: 'Quicksand', sans-serif;
            --font-msg: 'Caveat', cursive;
            --luna-plata: #d1d1d1;
            --accent: #4ade80;
        }
        #anti-burn-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: transform 1s ease-in-out; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #fff; overflow: hidden; font-family: var(--font-soft); }
        
        .grid { 
            display: grid; 
            grid-template-columns: 50% 50%; 
            grid-template-rows: 35% 65%; 
            height: 100vh; 
            padding: 20px; 
            box-sizing: border-box; 
            gap: 20px;
        }

        .box { background: var(--card); border-radius: 40px; border: 1px solid #1a1a1a; display: flex; position: relative; overflow: hidden; }

        .top-left-group { flex-direction: row; justify-content: space-evenly; align-items: center; padding: 10px 20px; }
        .time-info { text-align: center; flex: 1.3; }
        #hora { font-size: 6.5rem; font-weight: 300; line-height: 1; letter-spacing: -2px; }
        #fecha { font-size: 1.2rem; color: var(--dim); margin-top: 12px; white-space: nowrap; letter-spacing: 1px; }
        
        .weather-divider { width: 1px; height: 50%; background: #333; margin: 0 10px; }
        
        .weather-info { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            flex: 1; 
            gap: 0;
        }
        #clima-icon { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: -10px;
        }
        .lucide { width: 120px; height: 120px; stroke-width: 1.5px; }
        #clima-temp { 
            font-size: 5.5rem; 
            font-weight: 300; 
            line-height: 1;
        }

        .color-luna { stroke: var(--luna-plata); }
        .color-sol { stroke: #ffce54; }
        .color-nube { stroke: #a0a0a0; }
        .color-lluvia { stroke: #74b9ff; }

        .top-right-msg { background: transparent !important; border: none !important; justify-content: center; align-items: center; }
        #msg-arriba { font-family: var(--font-msg); line-height: 1.1; text-align: center; max-width: 90%; transition: opacity 1s ease; }

        .bottom-left-agenda { padding: 40px; flex-direction: column; justify-content: flex-start; }
        #contenedor-agenda { width: 100%; text-align: left; }
        .dia-seccion { margin-bottom: 25px; }
        .dia-seccion:first-child { border-bottom: 1px solid #222; padding-bottom: 25px; margin-bottom: 25px; }
        .agenda-header { font-size: 1.2rem; color: var(--dim); text-transform: uppercase; margin-bottom: 18px; font-weight: 700; }
        .agenda-list { margin: 0; padding-left: 0; list-style-type: none; }
        .agenda-evento { font-size: 2rem; color: #eee; margin-bottom: 12px; display: flex; align-items: flex-start; gap: 15px; }
        .agenda-evento::before { 
            content: ""; min-width: 10px; height: 10px; background: var(--accent); border-radius: 50%; 
            margin-top: 12px; box-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
        }

        .bottom-right-container { background: #000; border-radius: 40px; position: relative; overflow: hidden; border: 1px solid #1a1a1a; }
        .layer { position: absolute; width: 100%; height: 100%; transition: opacity 2s ease-in-out; opacity: 0; display: flex; align-items: center; justify-content: center; }
        .layer.active { opacity: 1; }
        
        .foto-img { width: 100%; height: 100%; object-fit: cover; }
        
        .poesia-box { 
            padding: 40px; 
            text-align: center; 
            background: linear-gradient(145deg, #111, #050505);
            display: flex; 
            flex-direction: column; 
            justify-content: center;
        }
        .poesia-txt { font-family: var(--font-msg); font-size: 3rem; line-height: 1.2; color: #e0e0e0; margin-bottom: 20px; }
        .poesia-autor { font-family: var(--font-soft); font-size: 1.2rem; color: var(--dim); text-transform: uppercase; letter-spacing: 2px; }

    </style>
</head>
<body>
<div id="anti-burn-container">
    <div class="grid">
        <div class="box top-left-group">
            <div class="time-info">
                <div id="hora">--:--</div>
                <div id="fecha">...</div>
            </div>
            <div class="weather-divider"></div>
            <div class="weather-info">
                <div id="clima-icon"></div>
                <div id="clima-temp">--°</div>
            </div>
        </div>
        <div class="box top-right-msg"><div id="msg-arriba">Cargando...</div></div>
        <div id="caja-agenda" class="box bottom-left-agenda"><div id="contenedor-agenda"></div></div>
        
        <div class="bottom-right-container" id="cuadrante-dinamico">
            <div class="layer active" id="capa1"></div>
            <div class="layer" id="capa2"></div>
        </div>
    </div>
</div>

<script>
    const AGENDA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-WKumAlyEyQXUD9I-5qhxn0vBbI6M238FwuhctONAQfcsmKhwAIfO5gLbnZhiild3nqmRR-2n9mo/pub?output=csv';
    const FRASES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQsVTl_DwnvHg14G_rV5iUFOHal3B4w3llcCZsZwTNMh7uvx8YXdctdWXX2nbRVRpxizkZPKb665nKo/pub?output=csv';

    const antologia = [
        {txt: "Caminante, no hay camino, se hace camino al andar.", autor: "Antonio Machado"},
        {txt: "Podrá nublarse el sol eternamente... pero jamás podrá apagarse el amor.", autor: "Gustavo A. Bécquer"},
        {txt: "Juventud, divino tesoro, ¡ya te vas para no volver!", autor: "Rubén Darío"},
        {txt: "Verde que te quiero verde. Verde viento. Verdes ramas.", autor: "Federico G. Lorca"},
        {txt: "Me gustas cuando callas porque estás como ausente.", autor: "Pablo Neruda"},
        {txt: "Todo pasa y todo queda, pero lo nuestro es pasar.", autor: "Antonio Machado"},
        {txt: "Yo soy yo y mi circunstancia, y si no la salvo a ella no me salvo yo.", autor: "José Ortega y Gasset"},
        {txt: "La libertad, Sancho, es uno de los más preciosos dones que a los hombres dieron los cielos.", autor: "Miguel de Cervantes"},
        {txt: "He andado muchos caminos, he abierto muchas veredas.", autor: "Antonio Machado"},
        {txt: "Porque eso es lo que hace el amor: nos inventa.", autor: "Octavio Paz"},
        {txt: "El que lee mucho y anda mucho, ve mucho y sabe mucho.", autor: "Miguel de Cervantes"},
        {txt: "La vida es sueño, y los sueños, sueños son.", autor: "Pedro Calderón de la Barca"},
        {txt: "La patria es dicha de todos, y dolor de todos, y cielo para todos.", autor: "José Martí"},
        {txt: "No hay que llorar, que la vida es un carnaval.", autor: "Celia Cruz"},
        {txt: "El sur también existe.", autor: "Mario Benedetti"},
        {txt: "El mundo es ancho y ajeno.", autor: "Ciro Alegría"},
        {txt: "Yo no pinto lo que veo, pinto lo que siento.", autor: "Frida Kahlo"},
        {txt: "Nosotros, los de entonces, ya no somos los mismos.", autor: "Pablo Neruda"},
        {txt: "La muerte no es verdad cuando se ha cumplido bien la obra de la vida.", autor: "José Martí"},
        {txt: "A veces el silencio es la peor mentira.", autor: "Miguel de Unamuno"},
        {txt: "El amor es tan corto y el olvido tan largo.", autor: "Pablo Neruda"},
        {txt: "Y sin embargo, se mueve.", autor: "Galileo Galilei"},
        {txt: "La poesía es el diálogo del hombre con su tiempo.", autor: "Octavio Paz"},
        {txt: "Amor constante más allá de la muerte.", autor: "Francisco de Quevedo"},
        {txt: "La casa es chica y el corazón grande.", autor: "Alfonsina Storni"},
        {txt: "Hay golpes en la vida, tan fuertes... ¡Yo no sé!", autor: "César Vallejo"},
        {txt: "Somos lo que hacemos para cambiar lo que somos.", autor: "Eduardo Galeano"},
        {txt: "La poesía es un arma cargada de futuro.", autor: "Gabriel Celaya"},
        {txt: "He cometido el peor de los pecados que un hombre puede cometer. No he sido feliz.", autor: "Jorge Luis Borges"},
        {txt: "La vida no es la que uno vivió, sino la que uno recuerda.", autor: "Gabriel García Márquez"},
        {txt: "La realidad no tiene la culpa de que no nos guste.", autor: "Jorge Luis Borges"}
    ];

    function getLunaLucide(fecha) {
        let year = fecha.getFullYear(); let month = fecha.getMonth() + 1; let day = fecha.getDate();
        if (month < 3) { year--; month += 12; }
        let jd = 365.25 * year + 30.6 * month + day - 694039.09; jd /= 29.5305882;
        let b = parseInt(jd); jd -= b; let fase = Math.round(jd * 8); fase = fase >= 8 ? 0 : fase;
        const iconos = ['moon-star', 'moon', 'moon', 'moon', 'circle', 'moon', 'moon', 'moon'];
        return iconos[fase];
    }

    function reloj() {
        const ahora = new Date();
        document.getElementById('hora').textContent = ahora.getHours().toString().padStart(2, '0') + ":" + ahora.getMinutes().toString().padStart(2, '0');
        const d = ahora.toLocaleDateString('es-AR', { weekday: 'short' }).replace('.', '').toLowerCase();
        const n = ahora.getDate();
        const m = ahora.toLocaleDateString('es-AR', { month: 'short' }).replace('.', '').toLowerCase();
        const a = ahora.getFullYear();
        document.getElementById('fecha').textContent = `${d} ${n} ${m} ${a}`;
    }

    async function clima() {
        try {
            const ahora = new Date(); const h = ahora.getHours(); const esNoche = (h >= 20 || h < 7);
            const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-34.61&longitude=-58.43&current=temperature_2m,weather_code');
            const d = await r.json();
            document.getElementById('clima-temp').textContent = Math.round(d.current.temperature_2m) + "°";
            const el = document.getElementById('clima-icon');
            let icon = "cloud"; let color = "color-nube";
            if (d.current.weather_code <= 1) { 
                if (esNoche) { icon = getLunaLucide(ahora); color = "color-luna"; } 
                else { icon = "sun"; color = "color-sol"; }
            } else if (d.current.weather_code >= 51) { icon = "cloud-rain"; color = "color-lluvia"; }
            el.innerHTML = `<i data-lucide="${icon}" class="${color}"></i>`;
            lucide.createIcons();
        } catch (e) {}
    }

    async function cargarAgenda() {
        const h = new Date().getHours();
        const contenedor = document.getElementById('contenedor-agenda');
        const caja = document.getElementById('caja-agenda');
        if (h >= 22 || h < 7) { 
            caja.style.background = "#000"; caja.style.justifyContent = "center"; caja.style.alignItems = "center"; caja.style.display = "flex";
            contenedor.innerHTML = `
                <div style="text-align: center;">
                    <img src="https://lh3.googleusercontent.com/d/1CwXkKNllm_hCjLKacZjTywh7gm2FCKrp" 
                         style="width: 80%; opacity: 0.7; border-radius: 20px; margin-top: 40px;">
                    <div style="font-family: var(--font-msg); color: #777; font-size: 2.2rem; margin-top: 25px; line-height: 1.15; padding: 0 20px;">…que linda mi camita…para dormir, dormir, y descansar…</div>
                </div>`;
            return; 
        }
        caja.style.background = "var(--card)";
        try {
            const r = await fetch(AGENDA_URL + '&t=' + Date.now());
            const text = await r.text();
            const lineas = text.split(/\r?\n/);
            let hTotal = ""; const hoy = new Date();
            for (let i = 0; i < 2; i++) {
                let fLoop = new Date(); fLoop.setDate(hoy.getDate() + i);
                let fBusqueda = `${fLoop.getDate().toString().padStart(2,'0')}/${(fLoop.getMonth()+1).toString().padStart(2,'0')}/${fLoop.getFullYear().toString().slice(-2)}`;
                let tDia = i === 0 ? "HOY" : "MAÑANA";
                const eventos = lineas.filter(l => l.includes(fBusqueda));
                let lista = '<ul class="agenda-list">';
                eventos.forEach(l => {
                    let txt = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    txt = (txt[1] || txt[0]).replace(/"/g, '').trim();
                    if (txt) lista += `<li class="agenda-evento">${txt}</li>`;
                });
                hTotal += `<div class="dia-seccion"><div class="agenda-header">${tDia} ${fLoop.getDate()}/${fLoop.getMonth()+1}</div>${lista || 'Sin actividades'}</ul></div>`;
            }
            contenedor.innerHTML = hTotal;
        } catch (e) {}
    }

    let alternarCapa = true;
    function actualizarCuadrante() {
        const c1 = document.getElementById('capa1');
        const c2 = document.getElementById('capa2');
        const target = alternarCapa ? c2 : c1;
        const old = alternarCapa ? c1 : c2;

        const hActual = new Date().getHours();
        const esHorarioNocturno = (hActual >= 22 || hActual < 7);
        const mostrarPoesia = esHorarioNocturno ? false : (Math.random() > 0.5);

        if (mostrarPoesia) {
            const p = antologia[Math.floor(Math.random() * antologia.length)];
            target.innerHTML = `<div class="poesia-box"><div class="poesia-txt">"${p.txt}"</div><div class="poesia-autor">${p.autor}</div></div>`;
            target.classList.add('active');
            old.classList.remove('active');
            alternarCapa = !alternarCapa;
        } else {
            const img = new Image();
            img.src = `https://loremflickr.com/800/600/landscape,nature,forest/all?lock=${Math.floor(Math.random()*5000)}`;
            img.className = "foto-img";
            img.onload = () => {
                target.innerHTML = '';
                target.appendChild(img);
                target.classList.add('active');
                old.classList.remove('active');
                alternarCapa = !alternarCapa;
            };
        }
    }

    async function actualizarMensaje() {
        const msg = document.getElementById('msg-arriba');
        const ahora = new Date(); const min = ahora.getHours() * 60 + ahora.getMinutes();
        const esNoche = (ahora.getHours() >= 21 || ahora.getHours() < 7);
        let txt = "";
        try {
            const r = await fetch(FRASES_URL + '&t=' + Date.now());
            const csv = await r.text();
            csv.split(/\r?\n/).forEach(l => {
                let c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (c.length < 3 || c[0].includes("desde")) return;
                let dM = parseInt(c[0].split(':')[0])*60 + parseInt(c[0].split(':')[1] || 0);
                let hM = parseInt(c[1].split(':')[0])*60 + parseInt(c[1].split(':')[1] || 0);
                if (hM < dM ? (min >= dM || min < hM) : (min >= dM && min < hM)) txt = c[2].replace(/"/g, '').trim();
            });
        } catch (e) {}
        msg.style.opacity = 0;
        setTimeout(() => {
            msg.innerHTML = txt;
            const paleta = esNoche ? ['#74b9ff', '#0984e3', '#dfe6e9'] : ['#ff7675', '#55efc4', '#81ecec', '#fab1a0'];
            msg.style.color = paleta[Math.floor(Math.random()*paleta.length)];
            msg.style.fontSize = esNoche ? "2.4rem" : "4.2rem";
            msg.style.opacity = 1;
        }, 800);
    }

    reloj(); clima(); cargarAgenda(); actualizarCuadrante(); actualizarMensaje();
    setInterval(reloj, 1000);
    setInterval(clima, 300000);
    setInterval(cargarAgenda, 60000);
    setInterval(actualizarCuadrante, 15000);
    setInterval(actualizarMensaje, 30000);
</script>
</body>
</html>
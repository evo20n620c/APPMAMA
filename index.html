<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Reloj Familiar Premium - Noticias Legibles</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { 
            --bg: #000; --card: #111; --dim: #777; 
            --font-soft: 'Quicksand', sans-serif;
            --font-msg: 'Caveat', cursive;
            --accent: #4ade80;
        }
        #anti-burn-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            transition: transform 1s ease-in-out; background: var(--bg);
        }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #fff; overflow: hidden; font-family: var(--font-soft); }
        
        .grid { 
            display: grid; 
            grid-template-columns: 50% 50%; 
            grid-template-rows: 22% 70% 8%; 
            height: 100vh; padding: 20px; box-sizing: border-box; gap: 15px; 
        }

        .box { background: var(--card); border-radius: 40px; border: 1px solid #1a1a1a; display: flex; position: relative; overflow: hidden; }
        .top-left-group { flex-direction: row; justify-content: space-evenly; align-items: center; padding: 10px 20px; }
        #hora { font-size: 5.5rem; font-weight: 300; line-height: 1; letter-spacing: -2px; }
        #fecha { font-size: 1.1rem; color: var(--dim); margin-top: 8px; }
        .weather-divider { width: 1px; height: 50%; background: #333; margin: 0 10px; }
        #clima-temp { font-size: 4.5rem; font-weight: 300; }
        .top-right-msg { background: transparent !important; border: none !important; justify-content: center; align-items: center; }
        #msg-arriba { font-family: var(--font-msg); text-align: center; max-width: 95%; transition: opacity 1s ease; }
        
        .bottom-left-agenda { padding: 35px; flex-direction: column; }
        .agenda-evento { font-size: 1.4rem; color: #eee; margin-bottom: 10px; display: flex; align-items: flex-start; gap: 15px; }
        .agenda-evento::before { content: ""; min-width: 10px; height: 10px; background: var(--accent); border-radius: 50%; margin-top: 10px; }
        
        .bottom-right-container { display: flex; flex-direction: column; gap: 15px; background: transparent; border: none; }
        .paisaje-mini-box { height: 60%; background: #000; border-radius: 40px; overflow: hidden; border: 1px solid #1a1a1a; position: relative; }
        .layer { position: absolute; width: 100%; height: 100%; transition: opacity 2s; opacity: 0; background-size: cover; background-position: center; }
        .layer.active { opacity: 1; }
        
        .trivia-box { height: calc(40% - 15px); background: linear-gradient(145deg, #111, #050505); border-radius: 40px; border: 1px solid #1a1a1a; padding: 15px 25px; display: flex; flex-direction: column; justify-content: center; text-align: center; }
        .trivia-txt { font-size: 1.4rem; color: #fff; margin-bottom: 5px; }
        .trivia-res { font-size: 1.4rem; color: var(--accent); }

        .news-ticker {
            grid-column: span 2;
            background: #050505;
            border-radius: 50px;
            border: 1px solid #222;
            display: flex;
            align-items: center;
            overflow: hidden;
            white-space: nowrap;
            padding: 0 20px;
        }
        .ticker-label {
            background: #e74c3c;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-right: 15px;
            text-transform: uppercase;
        }
        #noticias-scroll {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 80s linear infinite; /* VELOCIDAD AJUSTADA A 80 SEGUNDOS (MÁS LENTO) */
            font-size: 1.3rem;
            color: #ccc;
        }
        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
    </style>
</head>
<body>
<div id="anti-burn-container">
    <div class="grid">
        <div class="box top-left-group">
            <div style="text-align: center;"><div id="hora">--:--</div><div id="fecha">...</div></div>
            <div class="weather-divider"></div>
            <div style="display: flex; flex-direction: column; align-items: center;"><div id="clima-icon"></div><div id="clima-temp">--°</div></div>
        </div>
        <div class="box top-right-msg"><div id="msg-arriba">Cargando...</div></div>
        <div id="caja-agenda" class="box bottom-left-agenda"><div id="contenedor-agenda"></div></div>
        <div class="bottom-right-container">
            <div class="paisaje-mini-box"><div class="layer active" id="capa1"></div><div class="layer" id="capa2"></div></div>
            <div class="trivia-box" id="trivia-container"><div id="trivia-content" style="transition: opacity 0.5s;"></div></div>
        </div>
        <div class="news-ticker">
            <div class="ticker-label">Noticias</div>
            <div id="noticias-scroll">Sincronizando titulares de Argentina...</div>
        </div>
    </div>
</div>

<script>
    const AGENDA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-WKumAlyEyQXUD9I-5qhxn0vBbI6M238FwuhctONAQfcsmKhwAIfO5gLbnZhiild3nqmRR-2n9mo/pub?output=csv';
    const FRASES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQsVTl_DwnvHg14G_rV5iUFOHal3B4w3llcCZsZwTNMh7uvx8YXdctdWXX2nbRVRpxizkZPKb665nKo/pub?output=csv';
    const TRIVIA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTtMdkYueUYgWcnwisUPstM2S4o2VTMbAyZ48QIu4eYWXvK0U9JGfmn0VyT3axG_7jgEmixm6Lzhg_E/pub?output=csv';
    
    const NEWS_URL = 'https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fnews.google.com%2Frss%2Fheadlines%2Fsection%2Fgeo%2FArgentina%3Fhl%3Des-419%26gl%3DAR%26ceid%3DAR%3Aes-419';

    let triviasExterna = [], triviaFase = 0, triviaActual = null;

    function aplicarAntiBurn() {
        const container = document.getElementById('anti-burn-container');
        container.style.transform = `translate(${Math.random()*4-2}px, ${Math.random()*4-2}px)`;
    }

    async function cargarNoticias() {
        try {
            const r = await fetch(NEWS_URL);
            const d = await r.json();
            if(d.status === 'ok') {
                const titulares = d.items.map(i => i.title.split(' - ')[0]).join("   •   ");
                document.getElementById('noticias-scroll').textContent = titulares + "   •   ";
            }
        } catch (e) {
            document.getElementById('noticias-scroll').textContent = "Titulares: Sincronizando últimas noticias de Argentina...";
        }
    }

    async function cargarTriviaExterna() {
        try {
            const r = await fetch(TRIVIA_URL + '&t=' + Date.now());
            const text = await r.text();
            triviasExterna = text.split(/\r?\n/).map(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return c.length >= 5 ? { p: c[0].replace(/"/g, '').trim(), o: [`A) ${c[1].replace(/"/g, '').trim()}`, `B) ${c[2].replace(/"/g, '').trim()}`, `C) ${c[3].replace(/"/g, '').trim()}`], r: c[4].replace(/"/g, '').trim() } : null;
            }).filter(t => t);
        } catch (e) {}
    }

    function reloj() {
        const ahora = new Date();
        document.getElementById('hora').textContent = ahora.getHours().toString().padStart(2, '0') + ":" + ahora.getMinutes().toString().padStart(2, '0');
        document.getElementById('fecha').textContent = ahora.toLocaleDateString('es-AR', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' }).replace('.', '');
    }

    async function clima() {
        try {
            const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-34.61&longitude=-58.43&current=temperature_2m,weather_code');
            const d = await r.json();
            document.getElementById('clima-temp').textContent = Math.round(d.current.temperature_2m) + "°";
            document.getElementById('clima-icon').innerHTML = `<i data-lucide="${d.current.weather_code <= 1 ? 'sun' : 'cloud'}"></i>`;
            lucide.createIcons();
        } catch (e) {}
    }

    async function cargarAgenda() {
        try {
            const r = await fetch(AGENDA_URL + '&t=' + Date.now());
            const text = await r.text();
            const lineas = text.split(/\r?\n/);
            let hTotal = ""; const hoy = new Date();
            for (let i = 0; i < 2; i++) {
                let f = new Date(); f.setDate(hoy.getDate() + i);
                let buscar = `${f.getDate().toString().padStart(2,'0')}/${(f.getMonth()+1).toString().padStart(2,'0')}`;
                const eventos = lineas.filter(l => (l.split(',')[0] || "").includes(buscar));
                let lista = eventos.map(l => {
                    const partes = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return partes[1] ? `<li class="agenda-evento">${partes[1].replace(/"/g, '').trim()}</li>` : "";
                }).join('');
                hTotal += `<div style="margin-bottom:20px;"><div style="font-size:1.1rem;color:var(--dim);text-transform:uppercase;font-weight:700;margin-bottom:10px;">${i===0?'HOY':'MAÑANA'} ${f.getDate()}/${f.getMonth()+1}</div><ul style="list-style:none;padding:0;">${lista || 'Sin actividades'}</ul></div>`;
            }
            document.getElementById('contenedor-agenda').innerHTML = hTotal;
            aplicarAntiBurn();
        } catch (e) {}
    }

    let alternar = true;
    function actualizarPaisaje() {
        const c1 = document.getElementById('capa1'), c2 = document.getElementById('capa2');
        const t = alternar ? c2 : c1, o = alternar ? c1 : c2;
        const url = `https://picsum.photos/id/${Math.floor(Math.random()*500)+10}/1000/800`;
        const img = new Image(); img.src = url;
        img.onload = () => { t.style.backgroundImage = `url('${url}')`; t.classList.add('active'); o.classList.remove('active'); alternar = !alternar; };
    }

    function actualizarTrivia() {
        const content = document.getElementById('trivia-content');
        if (!triviasExterna.length) return;
        content.style.opacity = 0;
        setTimeout(() => {
            if (triviaFase === 0) {
                triviaActual = triviasExterna[Math.floor(Math.random() * triviasExterna.length)];
                content.innerHTML = `<div class="trivia-txt">${triviaActual.p}</div><div style="color:#aaa; text-align:left; font-size: 1.1rem;">${triviaActual.o.join("<br>")}</div>`;
                triviaFase = 1;
            } else {
                content.innerHTML = `<div class="trivia-res">${triviaActual.r}</div>`;
                triviaFase = 0;
            }
            content.style.opacity = 1;
        }, 500);
    }

    async function actualizarMensaje() {
        try {
            const r = await fetch(FRASES_URL + '&t=' + Date.now());
            const csv = await r.text();
            let txt = ""; const min = new Date().getHours() * 60 + new Date().getMinutes();
            csv.split(/\r?\n/).forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (c.length < 3) return;
                const dM = parseInt(c[0].split(':')[0])*60 + parseInt(c[0].split(':')[1]||0);
                const hM = parseInt(c[1].split(':')[0])*60 + parseInt(c[1].split(':')[1]||0);
                if (min >= dM && min < hM) txt = c[2].replace(/"/g, '').trim();
            });
            const msg = document.getElementById('msg-arriba');
            msg.style.opacity = 0;
            setTimeout(() => { msg.innerHTML = txt; msg.style.color = '#ff7675'; msg.style.fontSize = "2.6rem"; msg.style.opacity = 1; }, 800);
        } catch (e) {}
    }

    reloj(); clima(); cargarAgenda(); actualizarPaisaje(); cargarTriviaExterna().then(actualizarTrivia); actualizarMensaje(); cargarNoticias();
    setInterval(reloj, 1000); 
    setInterval(clima, 300000); 
    setInterval(cargarAgenda, 60000); 
    setInterval(actualizarPaisaje, 30000); 
    setInterval(actualizarTrivia, 8000); 
    setInterval(actualizarMensaje, 30000);
    setInterval(cargarNoticias, 600000); 
</script>
</body>
</html>
